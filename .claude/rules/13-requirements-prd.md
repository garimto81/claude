# PRD-First 규칙 — 요구사항 영구 문서화 강제

**트리거**: 신규 기능 구현, 기존 기능 변경/확장, 설계 변경 수반 버그 수정, 규칙/커맨드/에이전트 추가

## 핵심 원칙

구현이 완료된 후에 PRD를 업데이트하는 것은 금지된다. PRD는 구현과 동시에 업데이트한다.

```
[올바른 흐름]
요청 수신 → docs/00-prd/ 확인 → PRD 확인/생성/업데이트 → 구현 → 완료

[금지 흐름]
요청 수신 → 구현 완료 → (PRD 업데이트 누락)
```

## 필수 행동 규칙

### Step 1: PRD 탐색 (구현 시작 전)
1. `docs/00-prd/` 디렉토리에서 관련 PRD 파일 탐색
2. 브랜치명 패턴 매칭: `feat/xxx` → `xxx.prd.md` 또는 관련 PRD 검색
3. 키워드 매칭: 구현 대상 기능명으로 PRD 내용 검색

### Step 2: PRD 상태 판단
| 상태 | 처리 |
|------|------|
| PRD 존재 + 최신 | 확인만 하고 진행 |
| PRD 존재 + 구식 | `## Changelog` 섹션에 변경사항 추가 후 진행 |
| PRD 없음 (신규 기능) | `/prd-update --new` 또는 PRD 신규 생성 후 진행 |
| PRD 없음 (소규모 수정) | `--skip-prd` 명시적 사용 + 이유 기록 후 진행 |

### Step 3: PRD Changelog 업데이트 형식

모든 PRD 파일에는 `## Changelog` 섹션이 있어야 한다. 없으면 추가한다.

```markdown
## Changelog

| 날짜 | 버전 | 변경 내용 | 결정 근거 |
|------|------|-----------|----------|
| 2026-02-24 | v1.1 | 청킹 전략 추가 | 대형 문서 토큰 초과 방지 |
| 2026-02-20 | v1.0 | 최초 작성 | - |
```

### Step 4: 커밋 컨벤션
PRD 업데이트 시 반드시 별도 커밋:
```
docs(prd): {feature명} 요구사항 반영
```

## 예외 허용 (--skip-prd)

아래 경우에만 PRD 업데이트를 건너뛸 수 있다. 반드시 이유를 명시해야 한다.

| 예외 케이스 | 조건 |
|------------|------|
| hotfix | 로직 변경 없음, 오타/들여쓰기/포맷만 수정 |
| docs 오타 | `.md` 파일 오타 수정만 |
| 설정 파일 | `.gitignore`, `.env.example` 등 설정값만 변경 |
| 리팩토링 | 외부 동작 변화 없는 내부 구조 개선 |

**사용 방법**: 요청에 `--skip-prd` + 이유를 명시하면 Lead가 PRD 업데이트를 건너뜀.

## Lead 실행 규칙

### 구현 요청 수신 시
1. 트리거 조건에 해당하면 PRD 탐색 먼저 실행
2. PRD 상태 판단 후 업데이트 또는 생성
3. 구현 진행

### 위반 감지 시
executor나 본인이 PRD 없이 구현을 완료했다면:
1. 즉시 중단
2. 관련 PRD 탐색 후 업데이트
3. `docs(prd): {feature} 요구사항 반영` 커밋 생성

## PRD 파일 위치 및 명명 규칙

```
docs/00-prd/
├── prd-{feature-name}.prd.md     # 표준 형식
├── {feature-name}.prd.md         # 단축 형식
└── README.md                     # PRD 디렉토리 인덱스 (선택)
```

**브랜치-PRD 매핑 패턴**:
- `feat/auth-system` → `prd-auth-system.prd.md`
- `feat/prd-chunking-strategy` → `prd-chunking-strategy.prd.md`
- `fix/token-overflow` → 관련 기능 PRD에 버그 수정 내역 추가

## PRD 최소 구조 (신규 생성 시)

```markdown
# {기능명} PRD

## 개요
- **목적**:
- **배경**:
- **범위**:

## 요구사항

### 기능 요구사항
1.

### 비기능 요구사항
1.

## 구현 상태

| 항목 | 상태 | 비고 |
|------|------|------|
|      | 완료/진행 중/예정 | |

## Changelog

| 날짜 | 버전 | 변경 내용 | 결정 근거 |
|------|------|-----------|----------|
| {오늘날짜} | v1.0 | 최초 작성 | - |
```

## 관련 커맨드

| 커맨드 | 용도 |
|--------|------|
| `/prd-update` | 로컬 PRD 업데이트 (브랜치 기반 자동 탐지) |
| `/prd-update --new` | 신규 PRD 생성 |
| `/prd-update --diff` | 구현 vs PRD 갭 분석 |
| `/prd-sync` | Google Docs ↔ 로컬 동기화 (별도 역할) |

## 금지 사항

- 구현 완료 후 PRD 업데이트 없이 세션 종료 금지
- PRD 업데이트를 "나중에"로 미루기 금지
- `--skip-prd` 이유 명시 없이 사용 금지
- PRD 없는 상태로 신규 기능 구현 완료 금지
