# PRD-0026: 토큰 관리 계획

**Version**: 1.0.0 | **Date**: 2025-12-06 | **Status**: Draft
**Parent**: [PRD-0025](./MAIN-0025-master-workflow-optimization.md)
**Priority**: P0

---

## 1. 목적

세션당 토큰 사용량을 **56% 절감**하여 비용 효율성과 컨텍스트 활용도를 극대화합니다.

---

## 2. 현재 토큰 사용 분석

```
세션 시작 시 로딩:
┌─────────────────────────────────────────┐
│ CLAUDE.md              ~3500 토큰      │
│ Commands (28개)        ~4000 토큰      │
│ Skills 메타데이터       ~100 토큰       │
│ 기타 (hooks, settings) ~400 토큰       │
├─────────────────────────────────────────┤
│ 총 초기 컨텍스트       ~8000 토큰      │
└─────────────────────────────────────────┘
```

---

## 3. 토큰 절감 전략

### 3.1 Progressive Disclosure (목표: -4500 토큰)

| 구분 | Before | After | 절감 |
|------|--------|-------|------|
| Commands | ~4000 토큰 | ~400 토큰 (메타데이터) | **-3600** |
| CLAUDE.md | ~3500 토큰 | ~2000 토큰 | **-1500** |
| Agents 목록 | 인라인 | 외부 참조 | **-400** |

**원칙**:
- Level 1: 메타데이터만 (~100 토큰/스킬)
- Level 2: 필요 시 SKILL.md 로딩
- Level 3: 실행 시 scripts/ 호출

### 3.2 CLAUDE.md 리팩토링 (257줄 → 150줄)

| 섹션 | 현재 | 목표 | 변경 |
|------|------|------|------|
| Phase Pipeline | 30줄 | 15줄 | 축소 + 외부 참조 |
| Commands | 25줄 | 0줄 | Skills Index로 대체 |
| Agents | 35줄 | 5줄 | 외부 참조 |
| Architecture | 30줄 | 15줄 | 축소 |
| Browser Testing | 20줄 | 0줄 | Skills 참조 |

---

## 4. 토큰 예산 모델

### 4.1 세션별 할당

| 구분 | 예산 | 용도 |
|------|------|------|
| 초기 컨텍스트 | 3500 토큰 | CLAUDE.md + Skills 메타 |
| 작업 컨텍스트 | 20000 토큰 | 파일 읽기, 에이전트 |
| 응답 생성 | 8000 토큰 | 코드, 설명 |
| 버퍼 | 2000 토큰 | 예비 |
| **총합** | **33500 토큰** | 세션 상한 |

### 4.2 Extended Thinking 예산

| Mode | 토큰 | 사용 시점 |
|------|------|----------|
| (none) | 0 | 단순 작업 |
| `think` | 4K | 복잡한 버그 |
| `think hard` | 10K | 아키텍처 결정 |
| `think harder` | 20K | 멀티파일 리팩토링 |
| `ultrathink` | 32K | 분산 시스템, 복잡 TDD |

**비용 효율 원칙**:
- Error cost > $5 → ultrathink
- Time saved > 1 hour → ultrathink
- 단순 CRUD → thinking 없음

---

## 5. 모니터링

### 5.1 경고 임계값

| 레벨 | 토큰 사용량 | 액션 |
|------|------------|------|
| 🟢 정상 | < 25000 | 계속 |
| 🟡 주의 | 25000-30000 | 파일 읽기 줄이기 |
| 🔴 위험 | > 30000 | 세션 분할 |

### 5.2 추적 메트릭 (권장)

```python
session_metrics = {
    "initial_context": 3500,
    "skills_loaded": [],
    "files_read": 0,
    "total_tokens": 0,
    "thinking_tokens": 0
}
```

---

## 6. 구현 Task

- [ ] Task 1: CLAUDE.md v4.0.0 초안 작성 (150줄)
- [ ] Task 2: 외부 참조 문서 정리
- [ ] Task 3: 토큰 모니터링 스크립트 (선택)

---

## 7. 성공 지표

| 지표 | 현재 | 목표 |
|------|------|------|
| 초기 컨텍스트 | ~8000 | ~3500 |
| CLAUDE.md 줄 수 | 257 | 150 |
| 세션당 평균 토큰 | 측정 필요 | < 30000 |

---

**Dependencies**: 없음 (독립 실행 가능)
**Next**: PRD-0027 (Skills 마이그레이션)

